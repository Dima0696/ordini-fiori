<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#4CAF50">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="LombardaFlor Orders">
  <title>LombardaFlor Orders</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="pull-to-refresh-styles.css">
  <link rel="manifest" href="manifest.json">
</head>
<body>
  
  <!-- PAGINA LOGIN -->
  <div id="page-login" class="page active">
    <div class="login-container">
      <div class="login-card">
        <img src="logo.png" alt="LombardaFlor" class="login-logo">
        <h1>LombardaFlor Orders</h1>
        <p class="login-subtitle">Accedi per continuare</p>
        
        <form id="login-form">
          <div class="form-group">
            <label for="login-username">Utente</label>
            <select id="login-username" required>
              <option value="">Seleziona utente</option>
              <option value="Massimo">Massimo</option>
              <option value="Gianluca">Gianluca</option>
              <option value="Gigi">Gigi</option>
              <option value="Carlo">Carlo</option>
              <option value="Dimitri">Dimitri</option>
              <option value="Federica">Federica</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="login-password">Password</label>
            <input type="password" id="login-password" placeholder="Inserisci password" required>
          </div>
          
          <div id="login-error" class="login-error" style="display: none;"></div>
          
          <button type="submit" class="btn-primary btn-large">üîê Accedi</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- PAGINA CALENDARIO -->
  <div id="page-calendar" class="page">
    <header class="app-header">
      <div class="app-header-left">
        <img src="logo.png" alt="LombardaFlor" class="app-logo">
      </div>
      <div class="app-header-right">
        <button id="btn-notifications" class="btn-icon" title="Notifiche">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
        </button>
        <button id="btn-logout" class="btn-logout">
          <span id="username-display"></span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
        </button>
      </div>
    </header>
    
    <!-- Pull to refresh indicator -->
    <div id="pull-refresh-indicator-calendar" class="pull-refresh-indicator">
      <div class="pull-refresh-spinner"></div>
      <span class="pull-refresh-text">Aggiornamento...</span>
    </div>
    
    <div class="calendar-container">
      <!-- Barra di ricerca -->
      <div class="search-container">
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input 
            type="text" 
            id="search-input" 
            placeholder="Cerca cliente o prodotto..."
            autocomplete="off"
          >
          <button id="btn-clear-search" class="btn-clear-search" style="display: none;">‚úï</button>
        </div>
        <div class="search-info">
          Ricerca negli ordini da 1 settimana fa a 3 settimane avanti
        </div>
      </div>
      
      <div class="month-selector">
        <button id="prev-month" class="btn-month">‚Üê</button>
        <h2 id="current-month">Gennaio 2025</h2>
        <button id="next-month" class="btn-month">‚Üí</button>
      </div>
      
      <div id="days-list" class="days-list">
        <!-- Giorni generati dinamicamente -->
      </div>
    </div>
    
    <!-- Floating Action Button - Nuovo Ordine -->
    <button id="btn-fab-new-order" class="fab-new-order" title="Nuovo ordine">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    </button>
  </div>

  <!-- PAGINA ORDINI DEL GIORNO -->
  <div id="page-orders" class="page">
    <header class="app-header">
      <div class="app-header-left">
        <button id="btn-back" class="btn-back">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
        </button>
        <h1 id="orders-date-title" class="orders-title">Ordini</h1>
      </div>
      <div class="app-header-right">
        <button id="btn-notifications-orders" class="btn-icon" title="Notifiche">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
        </button>
        <button id="btn-logout-orders" class="btn-logout">
          <span id="username-display-orders"></span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
        </button>
      </div>
    </header>
    
    <!-- Pull to refresh indicator -->
    <div id="pull-refresh-indicator-orders" class="pull-refresh-indicator">
      <div class="pull-refresh-spinner"></div>
      <span class="pull-refresh-text">Aggiornamento...</span>
    </div>
    
    <div class="orders-container">
      <div class="order-actions-top">
        <button id="btn-new-order" class="btn-primary btn-large">‚ûï Nuovo ordine</button>
        <button id="btn-fabbisogno" class="btn-secondary btn-large">üìã Fabbisogno giorno</button>
      </div>
      
      <div id="orders-list" class="orders-list">
        <!-- Ordini generati dinamicamente -->
      </div>
      
      <div id="empty-message" class="empty-message" style="display: none;">
        <p>Nessun ordine per questo giorno</p>
        <p class="empty-subtitle">Tocca "Nuovo ordine" per iniziare</p>
      </div>
    </div>
  </div>

  <!-- MODAL NUOVO ORDINE / MODIFICA ORDINE -->
  <div id="modal-order" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">Nuovo ordine</h2>
        <button id="btn-close-modal" class="btn-close">‚úï</button>
      </div>
      
      <form id="order-form">
        <input type="hidden" id="order-id">
        
        <!-- ROW 1: Data e Cliente -->
        <div class="form-row">
          <div class="form-group">
            <label for="order-date">Data</label>
            <input type="date" id="order-date" required>
          </div>
          
          <div class="form-group">
            <label for="order-customer">Cliente</label>
            <input type="text" id="order-customer" placeholder="Fioreria Rossi" required>
          </div>
        </div>
        
        <!-- ROW 2: Descrizione (full width) -->
        <div class="form-group">
          <label for="order-description">Merce</label>
          <textarea id="order-description" rows="3" placeholder="es. 3 casse rose, 5 mazzi eucalyptus" required></textarea>
        </div>
        
        <!-- ROW 3: Tipo Ordine e Tipo Merce -->
        <div class="form-row">
          <div class="form-group">
            <label for="order-type">Ricevuto via</label>
            <select id="order-type">
              <option value="cliente">Cliente</option>
              <option value="whatsapp">WhatsApp</option>
              <option value="mail">Email</option>
              <option value="telefono">Telefono</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="goods-type">
              Disponibilit√†
              <span id="goods-type-info" style="display: none; font-size: 0.7rem; color: #999; font-weight: normal; text-transform: none;">
                (solo magazzino)
              </span>
            </label>
            <select id="goods-type">
              <option value="in_cella">‚úÖ In giacenza</option>
              <option value="da_ordinare">üî¥ Da ordinare</option>
              <option value="ordinata">üü† Ordinata</option>
            </select>
          </div>
        </div>
        
        <!-- ROW 4: Modalit√† Consegna -->
        <div class="form-group">
          <label for="delivery-type">Modalit√†</label>
          <div class="delivery-buttons">
            <button type="button" class="btn-delivery active" data-delivery="ritiro">Ritiro</button>
            <button type="button" class="btn-delivery" data-delivery="consegna">Consegna</button>
          </div>
          <input type="hidden" id="delivery-type" value="ritiro">
        </div>
        
        <!-- ROW 5: Orario e Indirizzo (condizionale) -->
        <div class="form-row">
          <div class="form-group">
            <label for="delivery-time">Orario</label>
            <input type="time" id="delivery-time">
          </div>
          
          <div class="form-group" id="address-group" style="display: none;">
            <label for="delivery-address">Indirizzo</label>
            <input type="text" id="delivery-address" placeholder="Via, citt√†">
          </div>
        </div>
        
        <!-- ROW 6: Foto -->
        <div class="form-group">
          <label>Foto</label>
          <input type="file" id="photo-input" accept="image/*" multiple style="display: none;">
          <button type="button" id="btn-add-photo" class="btn-secondary btn-compact">Aggiungi foto</button>
          <div id="photo-preview" class="photo-preview"></div>
        </div>
        
        <!-- ROW 7: Stato (solo in modifica) -->
        <div class="form-group" id="status-group" style="display: none;">
          <label>üéØ Stato Ordine</label>
          <div class="status-buttons">
            <button type="button" class="btn-status" data-status="da_preparare">üìã Da preparare</button>
            <button type="button" class="btn-status" data-status="pronto">‚úÖ Pronto</button>
            <button type="button" class="btn-status" data-status="ritirato">üéâ Ritirato</button>
          </div>
          <input type="hidden" id="order-status" value="da_preparare">
        </div>
        
        <!-- AZIONI -->
        <div class="form-actions">
          <button type="submit" class="btn-primary btn-large">üíæ Salva Ordine</button>
          <button type="button" id="btn-delete-order" class="btn-danger btn-compact" style="display: none;">
            üóëÔ∏è Elimina
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL CONFERMA ELIMINAZIONE -->
  <div id="modal-confirm" class="modal">
    <div class="modal-content modal-small">
      <h3>Conferma eliminazione</h3>
      <p>Sei sicuro di voler eliminare questo ordine?</p>
      <div class="modal-actions">
        <button id="btn-confirm-delete" class="btn-danger">Elimina</button>
        <button id="btn-cancel-delete" class="btn-secondary">Annulla</button>
      </div>
    </div>
  </div>

  <!-- MODAL FABBISOGNO -->
  <div id="modal-fabbisogno" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="fabbisogno-title">Fabbisogno del giorno</h2>
        <button id="btn-close-fabbisogno" class="btn-close">‚úï</button>
      </div>
      
      <div class="fabbisogno-container">
        <div class="fabbisogno-legend">
          <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--color-text);">Tipo Merce:</div>
          <span class="legend-item"><span class="legend-dot in-cella"></span> In giacenza</span>
          <span class="legend-item"><span class="legend-dot da-ordinare"></span> Da ordinare</span>
          <span class="legend-item"><span class="legend-dot ordinata"></span> Ordinata</span>
        </div>
        
        <div id="fabbisogno-list" class="fabbisogno-list">
          <!-- Fabbisogno generato dinamicamente -->
        </div>
        
        <div id="fabbisogno-empty" class="empty-message" style="display: none;">
          <p>‚úÖ Nessun ordine da preparare</p>
          <p class="empty-subtitle">Tutti gli ordini sono pronti o ritirati</p>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL DETTAGLIO ORDINE -->
  <div id="modal-detail" class="modal">
    <div class="modal-content modal-detail">
      <div class="modal-header">
        <img src="logo.png" alt="LombardaFlor" class="print-logo">
        <h2 id="detail-header-title">üìã Dettaglio Ordine</h2>
        <button id="btn-close-detail" class="btn-close">‚úï</button>
      </div>
      
      <div id="detail-content" class="detail-content">
        <!-- Contenuto generato dinamicamente -->
      </div>
      
      <div class="detail-edit-action no-print">
        <button id="btn-edit-from-detail" class="btn-edit-detail">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          <span>Modifica ordine</span>
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL CONDIVISIONE/AZIONI -->
  <div id="modal-share" class="modal">
    <div class="modal-content modal-share-content">
      <div class="modal-header">
        <button id="btn-close-share" class="btn-back">
          <svg class="icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          Indietro
        </button>
        <h2 id="share-header-title">Azioni Ordine</h2>
        <div style="width: 80px;"></div>
      </div>
      
      <div id="share-content" class="share-content">
        <div class="share-customer-name" id="share-customer-name"></div>
        <div class="share-order-date" id="share-order-date"></div>
        
        <div class="share-actions">
          <button id="btn-print-order" class="btn-share btn-share-print">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 6 2 18 2 18 9"></polyline>
              <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
              <rect x="6" y="14" width="12" height="8"></rect>
            </svg>
            <span>Stampa ordine</span>
          </button>
          
          <button id="btn-whatsapp-order" class="btn-share btn-share-whatsapp">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
            </svg>
            <span>Condividi WhatsApp</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL VISUALIZZA FOTO -->
  <div id="modal-photo" class="modal modal-photo">
    <div class="photo-viewer">
      <button id="btn-close-photo" class="btn-close-photo">‚úï Chiudi</button>
      <img id="photo-viewer-img" src="" alt="Foto ordine">
    </div>
  </div>

  <script src="pull-to-refresh.js"></script>
  <script src="app.js"></script>
</body>
</html>

