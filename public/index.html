<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#4CAF50">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="LombardaFlor Orders">
  <title>LombardaFlor Orders</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="pull-to-refresh-styles.css">
  <link rel="manifest" href="manifest.json">
</head>
<body>
  
  <!-- PAGINA LOGIN -->
  <div id="page-login" class="page active">
    <div class="login-container">
      <div class="login-card">
        <img src="logo.png" alt="LombardaFlor" class="login-logo">
        <h1>LombardaFlor Orders</h1>
        <p class="login-subtitle">Accedi per continuare</p>
        
        <form id="login-form">
          <div class="form-group">
            <label for="login-username">Utente</label>
            <select id="login-username" required>
              <option value="">Seleziona utente</option>
              <option value="Massimo">Massimo</option>
              <option value="Gianluca">Gianluca</option>
              <option value="Gigi">Gigi</option>
              <option value="Carlo">Carlo</option>
              <option value="Dimitri">Dimitri</option>
              <option value="Federica">Federica</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="login-password">Password</label>
            <input type="password" id="login-password" placeholder="Inserisci password" required>
          </div>
          
          <div id="login-error" class="login-error" style="display: none;"></div>
          
          <button type="submit" class="btn-primary btn-large">ğŸ” Accedi</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- PAGINA CALENDARIO -->
  <div id="page-calendar" class="page">
    <header class="app-header">
      <div class="app-header-left">
        <img src="logo.png" alt="LombardaFlor" class="app-logo">
      </div>
      <div class="app-header-right">
        <button id="btn-notifications" class="btn-icon" title="Notifiche">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
        </button>
        <button id="btn-logout" class="btn-logout">
          <span id="username-display"></span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
        </button>
      </div>
    </header>
    
    <!-- Pull to refresh indicator -->
    <div id="pull-refresh-indicator-calendar" class="pull-refresh-indicator">
      <div class="pull-refresh-spinner"></div>
      <span class="pull-refresh-text">Aggiornamento...</span>
    </div>
    
    <div class="calendar-container">
      <div class="quick-actions">
        <button id="btn-today-orders" class="btn-today">
          ğŸ“… Ordini di OGGI
        </button>
      </div>
      
      <div class="month-selector">
        <button id="prev-month" class="btn-month">â†</button>
        <h2 id="current-month">Gennaio 2025</h2>
        <button id="next-month" class="btn-month">â†’</button>
      </div>
      
      <div id="days-list" class="days-list">
        <!-- Giorni generati dinamicamente -->
      </div>
    </div>
  </div>

  <!-- PAGINA ORDINI DEL GIORNO -->
  <div id="page-orders" class="page">
    <header class="app-header">
      <div class="app-header-left">
        <button id="btn-back" class="btn-back">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
        </button>
        <h1 id="orders-date-title" class="orders-title">Ordini</h1>
      </div>
      <div class="app-header-right">
        <button id="btn-notifications-orders" class="btn-icon" title="Notifiche">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
        </button>
        <button id="btn-logout-orders" class="btn-logout">
          <span id="username-display-orders"></span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
        </button>
      </div>
    </header>
    
    <!-- Pull to refresh indicator -->
    <div id="pull-refresh-indicator-orders" class="pull-refresh-indicator">
      <div class="pull-refresh-spinner"></div>
      <span class="pull-refresh-text">Aggiornamento...</span>
    </div>
    
    <div class="orders-container">
      <div class="order-actions-top">
        <button id="btn-new-order" class="btn-primary btn-large">â• Nuovo ordine</button>
        <button id="btn-fabbisogno" class="btn-secondary btn-large">ğŸ“‹ Fabbisogno giorno</button>
      </div>
      
      <div id="orders-list" class="orders-list">
        <!-- Ordini generati dinamicamente -->
      </div>
      
      <div id="empty-message" class="empty-message" style="display: none;">
        <p>ğŸ“¦ Nessun ordine per questo giorno</p>
        <p class="empty-subtitle">Tocca "Nuovo ordine" per iniziare</p>
      </div>
    </div>
  </div>

  <!-- MODAL NUOVO ORDINE / MODIFICA ORDINE -->
  <div id="modal-order" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">Nuovo ordine</h2>
        <button id="btn-close-modal" class="btn-close">âœ•</button>
      </div>
      
      <form id="order-form">
        <input type="hidden" id="order-id">
        
        <!-- ROW 1: Data e Cliente -->
        <div class="form-row">
          <div class="form-group">
            <label for="order-date">ğŸ“… Data</label>
            <input type="date" id="order-date" required>
          </div>
          
          <div class="form-group">
            <label for="order-customer">ğŸ‘¤ Cliente</label>
            <input type="text" id="order-customer" placeholder="Fioreria Rossi" required>
          </div>
        </div>
        
        <!-- ROW 2: Descrizione (full width) -->
        <div class="form-group">
          <label for="order-description">ğŸ“ Merce</label>
          <textarea id="order-description" rows="3" placeholder="es. 3 casse rose, 5 mazzi eucalyptus" required></textarea>
        </div>
        
        <!-- ROW 3: Tipo Ordine e Tipo Merce -->
        <div class="form-row">
          <div class="form-group">
            <label for="order-type">ğŸ“ Ricevuto via</label>
            <select id="order-type">
              <option value="cliente">ğŸ‘¤ Cliente</option>
              <option value="whatsapp">ğŸ’¬ WhatsApp</option>
              <option value="mail">ğŸ“§ Email</option>
              <option value="telefono">ğŸ“ Telefono</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="goods-type">
              ğŸ“¦ DisponibilitÃ 
              <span id="goods-type-info" style="display: none; font-size: 0.7rem; color: #999; font-weight: normal; text-transform: none;">
                (solo magazzino)
              </span>
            </label>
            <select id="goods-type">
              <option value="in_cella">âœ… In giacenza</option>
              <option value="da_ordinare">ğŸ”´ Da ordinare</option>
              <option value="ordinata">ğŸŸ  Ordinata</option>
            </select>
          </div>
        </div>
        
        <!-- ROW 4: ModalitÃ  Consegna -->
        <div class="form-group">
          <label for="delivery-type">ğŸšš ModalitÃ </label>
          <div class="delivery-buttons">
            <button type="button" class="btn-delivery active" data-delivery="ritiro">ğŸ“¦ Ritiro</button>
            <button type="button" class="btn-delivery" data-delivery="consegna">ğŸšš Consegna</button>
          </div>
          <input type="hidden" id="delivery-type" value="ritiro">
        </div>
        
        <!-- ROW 5: Orario e Indirizzo (condizionale) -->
        <div class="form-row">
          <div class="form-group">
            <label for="delivery-time">ğŸ• Orario</label>
            <input type="time" id="delivery-time">
          </div>
          
          <div class="form-group" id="address-group" style="display: none;">
            <label for="delivery-address">ğŸ“ Indirizzo</label>
            <input type="text" id="delivery-address" placeholder="Via, cittÃ ">
          </div>
        </div>
        
        <!-- ROW 6: Foto -->
        <div class="form-group">
          <label>ğŸ“· Foto</label>
          <input type="file" id="photo-input" accept="image/*" multiple style="display: none;">
          <button type="button" id="btn-add-photo" class="btn-secondary btn-compact">ğŸ“· Aggiungi foto</button>
          <div id="photo-preview" class="photo-preview"></div>
        </div>
        
        <!-- ROW 7: Stato (solo in modifica) -->
        <div class="form-group" id="status-group" style="display: none;">
          <label>ğŸ¯ Stato Ordine</label>
          <div class="status-buttons">
            <button type="button" class="btn-status" data-status="da_preparare">ğŸ“‹ Da preparare</button>
            <button type="button" class="btn-status" data-status="pronto">âœ… Pronto</button>
            <button type="button" class="btn-status" data-status="ritirato">ğŸ‰ Ritirato</button>
          </div>
          <input type="hidden" id="order-status" value="da_preparare">
        </div>
        
        <!-- AZIONI -->
        <div class="form-actions">
          <button type="submit" class="btn-primary btn-large">ğŸ’¾ Salva Ordine</button>
          <button type="button" id="btn-delete-order" class="btn-danger btn-compact" style="display: none;">
            ğŸ—‘ï¸ Elimina
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL CONFERMA ELIMINAZIONE -->
  <div id="modal-confirm" class="modal">
    <div class="modal-content modal-small">
      <h3>Conferma eliminazione</h3>
      <p>Sei sicuro di voler eliminare questo ordine?</p>
      <div class="modal-actions">
        <button id="btn-confirm-delete" class="btn-danger">Elimina</button>
        <button id="btn-cancel-delete" class="btn-secondary">Annulla</button>
      </div>
    </div>
  </div>

  <!-- MODAL FABBISOGNO -->
  <div id="modal-fabbisogno" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="fabbisogno-title">Fabbisogno del giorno</h2>
        <button id="btn-close-fabbisogno" class="btn-close">âœ•</button>
      </div>
      
      <div class="fabbisogno-container">
        <div class="fabbisogno-legend">
          <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--color-text);">Tipo Merce:</div>
          <span class="legend-item"><span class="legend-dot in-cella"></span> In giacenza</span>
          <span class="legend-item"><span class="legend-dot da-ordinare"></span> Da ordinare</span>
          <span class="legend-item"><span class="legend-dot ordinata"></span> Ordinata</span>
        </div>
        
        <div id="fabbisogno-list" class="fabbisogno-list">
          <!-- Fabbisogno generato dinamicamente -->
        </div>
        
        <div id="fabbisogno-empty" class="empty-message" style="display: none;">
          <p>âœ… Nessun ordine da preparare</p>
          <p class="empty-subtitle">Tutti gli ordini sono pronti o ritirati</p>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL DETTAGLIO ORDINE -->
  <div id="modal-detail" class="modal">
    <div class="modal-content modal-detail">
      <div class="modal-header">
        <img src="logo.png" alt="LombardaFlor" class="print-logo">
        <h2 id="detail-header-title">ğŸ“‹ Dettaglio Ordine</h2>
        <button id="btn-close-detail" class="btn-close">âœ•</button>
      </div>
      
      <div id="detail-content" class="detail-content">
        <!-- Contenuto generato dinamicamente -->
      </div>
      
      <div class="detail-actions no-print">
        <button id="btn-print-order" class="btn-primary btn-large">ğŸ–¨ï¸ Stampa ordine</button>
        <button id="btn-whatsapp-order" class="btn-success btn-large">ğŸ’¬ WhatsApp</button>
        <button id="btn-edit-from-detail" class="btn-secondary btn-large">âœï¸ Modifica</button>
      </div>
      
      <div class="detail-status-actions no-print">
        <h3>Cambia Stato:</h3>
        <div class="status-change-buttons">
          <button class="btn-status-change btn-status-preparare" data-status="da_preparare">
            <span class="status-icon">â³</span>
            <span class="status-text">Da Preparare</span>
          </button>
          <button class="btn-status-change btn-status-pronto" data-status="pronto">
            <span class="status-icon">âœ…</span>
            <span class="status-text">Pronto</span>
          </button>
          <button class="btn-status-change btn-status-ritirato" data-status="ritirato">
            <span class="status-icon">ğŸ‰</span>
            <span class="status-text">Ritirato</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL VISUALIZZA FOTO -->
  <div id="modal-photo" class="modal modal-photo">
    <div class="photo-viewer">
      <button id="btn-close-photo" class="btn-close-photo">âœ• Chiudi</button>
      <img id="photo-viewer-img" src="" alt="Foto ordine">
    </div>
  </div>

  <script src="pull-to-refresh.js"></script>
  <script src="app.js"></script>
</body>
</html>

